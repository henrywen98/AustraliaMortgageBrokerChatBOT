# 🚀 多提供商AI支持配置指南

## 📋 支持的提供商

### 1. OpenAI
- **模型**: gpt-4o-mini, gpt-4, gpt-3.5-turbo 等
- **优势**: 性能优秀，功能全面
- **API文档**: https://platform.openai.com/docs

### 2. Deepseek
- **模型**: deepseek-chat, deepseek-coder 等  
- **优势**: 成本更低，中文支持优秀
- **API文档**: https://platform.deepseek.com/api-docs

## ⚙️ 配置步骤

### 步骤1: 获取API密钥

#### OpenAI API密钥
1. 访问 https://platform.openai.com/
2. 注册/登录账户
3. 进入 "API Keys" 页面
4. 点击 "Create new secret key"
5. 复制生成的密钥

#### Deepseek API密钥
1. 访问 https://platform.deepseek.com/
2. 注册/登录账户
3. 进入 "API Keys" 页面
4. 创建新的API密钥
5. 复制生成的密钥

### 步骤2: 配置环境变量

编辑 `.env` 文件：

```bash
# API Keys
OPENAI_API_KEY=your_openai_api_key_here
DEEPSEEK_API_KEY=your_deepseek_api_key_here

# Model Configuration  
MODEL_NAME=gpt-4o-mini          # 默认模型
MODEL_PROVIDER=openai           # 默认提供商: openai 或 deepseek

# RAG Settings
RAG_ENABLED=false               # 是否启用知识库检索
RAG_TOP_K=3                     # 检索文档数量
```

### 步骤3: 选择默认提供商

#### 使用OpenAI (推荐用于生产环境)
```bash
MODEL_PROVIDER=openai
MODEL_NAME=gpt-4o-mini
```

#### 使用Deepseek (推荐用于开发/测试)
```bash
MODEL_PROVIDER=deepseek  
MODEL_NAME=deepseek-chat
```

## 🎮 使用方法

### 方法1: 在Web界面切换
1. 启动应用: `streamlit run app.py`
2. 在左侧边栏选择 "AI提供商"
3. 从下拉菜单选择提供商
4. 系统会自动切换

### 方法2: 通过代码切换
```python
from utils.broker_logic import AustralianMortgageBroker

broker = AustralianMortgageBroker()

# 切换到Deepseek
broker.set_provider("deepseek")

# 切换到OpenAI
broker.set_provider("openai")
```

### 方法3: 环境变量切换
```bash
# 启动时指定提供商
MODEL_PROVIDER=deepseek streamlit run app.py
```

## 💰 成本比较

| 提供商 | 模型 | 输入价格 | 输出价格 | 适用场景 |
|--------|------|----------|----------|----------|
| OpenAI | gpt-4o-mini | $0.15/1M | $0.60/1M | 生产环境，高质量 |
| OpenAI | gpt-4 | $30/1M | $60/1M | 复杂任务 |
| Deepseek | deepseek-chat | ~$0.14/1M | ~$0.28/1M | 开发测试，成本敏感 |

## 🔧 故障排除

### 常见问题

#### 1. API密钥无效
**错误**: `Missing OPENAI_API_KEY` 或 `Missing DEEPSEEK_API_KEY`

**解决方案**:
- 检查 `.env` 文件中的API密钥
- 确保密钥格式正确，无额外空格
- 验证密钥在对应平台是否有效

#### 2. 模型不存在
**错误**: `模型未在列表中发现`

**解决方案**:
- 检查模型名称拼写
- 确认账户有权访问该模型
- 尝试使用默认模型

#### 3. 网络连接问题
**错误**: `Network Error` 或 `SSL Error`

**解决方案**:
- 检查网络连接
- 确认防火墙设置
- 如在国内，确保网络可以访问相应API

#### 4. 配额超限
**错误**: `HTTP 429` 或 `rate limit`

**解决方案**:
- 检查API配额使用情况
- 等待配额重置
- 升级API套餐

### 测试连接

运行测试脚本检查配置：

```bash
python test_multi_provider.py
```

## 📈 性能优化建议

### 1. 选择合适的模型
- **日常对话**: gpt-4o-mini 或 deepseek-chat
- **复杂分析**: gpt-4
- **代码生成**: deepseek-coder

### 2. 调整参数
```python
# 快速响应
client = UnifiedAIClient(model="gpt-4o-mini", timeout=30)

# 高质量输出
client = UnifiedAIClient(model="gpt-4", max_retries=5)
```

### 3. 缓存常见问题
- 启用RAG功能减少API调用
- 缓存常见问答结果

## 🔮 未来扩展

系统设计支持轻松添加新的AI提供商：

1. 在 `config.py` 添加API配置
2. 在 `UnifiedAIClient` 添加提供商逻辑
3. 更新界面选项

潜在扩展:
- Anthropic Claude
- Google Gemini  
- 阿里云通义千问
- 百度文心一言
